<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>TripSafe â€“ Your Safety, Our Priority</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --blue:#1e3a8a;
    --blueLight:#2563eb;
    --green:#10b981;
    --red:#ef4444;
    --ink:#0f172a;
    --bg:#f6f9ff;
    --purple:#7c3aed;
    --teal:#14b8a6;
    --amber:#f59e0b;
    --pink:#ec4899;
  }
  body{font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:#0f172a;}
  .trust-card{box-shadow:0 12px 28px rgba(2,6,23,.08);}
  .btn{transition:transform .06s ease, background .2s ease, box-shadow .2s ease}
  .btn:active{transform:translateY(1px)}
  .tile{transition:transform .12s ease, box-shadow .2s ease; animation: floaty 9s ease-in-out infinite}
  .tile:hover{transform:translateY(-2px); box-shadow:0 12px 24px rgba(2,6,23,.10)}
  .pulse-ring{position:absolute;inset:-10px;border-radius:9999px;border:2px solid rgba(239,68,68,.45);animation:ping 1.2s cubic-bezier(0,0,.2,1) infinite}
  @keyframes ping{0%{transform:scale(1);opacity:.9}75%{transform:scale(1.5);opacity:0}100%{transform:scale(1.5);opacity:0}}
  .fade-enter{opacity:0;transform:translateY(8px)}
  .fade-enter-active{opacity:1;transform:translateY(0);transition:all .25s ease}
  .map-hatch{background-image:repeating-linear-gradient(45deg, rgba(239,68,68,.12) 0, rgba(239,68,68,.12) 10px, rgba(239,68,68,.06) 10px, rgba(239,68,68,.06) 20px);}
  .safe-shade{background:rgba(16,185,129,.18);}
  .badge{box-shadow:0 6px 14px rgba(2,6,23,.08);}
  .segmented input:checked + label{background:#fff;color:var(--blue);box-shadow:0 6px 14px rgba(2,6,23,.08)}
  .chat-scroll{scroll-behavior:smooth}
  .call-anim{animation:callPulse 1.4s ease-in-out infinite}
  @keyframes callPulse{0%{transform:scale(1)}50%{transform:scale(1.05)}100%{transform:scale(1)}}
  /* Animated gradient buttons */
  .glow-btn{
    background: linear-gradient(135deg, var(--blueLight), var(--purple), var(--teal), var(--amber));
    background-size: 300% 300%;
    animation: gradientShift 6s ease infinite;
    box-shadow: 0 12px 26px rgba(37,99,235,.35);
  }
  .glow-btn:hover{box-shadow: 0 16px 30px rgba(37,99,235,.45)}
  @keyframes gradientShift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
  /* SOS subtle shine */
  .sos-shine{ position:relative; overflow:hidden; }
  .sos-shine:before{
    content:""; position:absolute; inset:-40% -40% auto auto; width:60%; height:200%;
    background: linear-gradient(60deg, rgba(255,255,255,.0) 0%, rgba(255,255,255,.35) 40%, rgba(255,255,255,0) 60%);
    transform: rotate(20deg); animation: shine 2.8s ease-in-out infinite;
  }
  @keyframes shine{0%{transform:translateX(-140%) rotate(20deg)}100%{transform:translateX(60%) rotate(20deg)}}
  /* Floating motion for tiles */
  @keyframes floaty{0%,100%{transform:translateY(0)}50%{transform:translateY(-3px)}}
  /* Menu pop animation */
  .menu-pop{animation: pop .25s ease forwards}
  @keyframes pop{0%{opacity:0; transform:translateY(8px) scale(.96)}100%{opacity:1; transform:translateY(0) scale(1)}}
  /* Colorful top accent */
  .top-accent{
    background: linear-gradient(90deg, rgba(37,99,235,.08), rgba(124,58,237,.08), rgba(20,184,166,.08));
  }
  /* Overlay that keeps FABs always visible */
  .floating-overlay{
    position: fixed; inset: 0; pointer-events: none; z-index: 40;
  }
  .floating-controls{
    position: absolute; right: 1.5rem; bottom: 1.5rem; display:flex; flex-direction:column; gap:.75rem; align-items:flex-end;
    pointer-events: none;
  }
  .floating-controls > *{ pointer-events: auto; }
</style>
</head>
<body class="min-h-screen flex items-center justify-center">
  <div id="app" class="w-full max-w-sm mx-auto bg-white rounded-3xl trust-card overflow-hidden relative">
    <!-- Global Topbar -->
    <header id="topbar" class="hidden px-4 py-3 flex items-center justify-between bg-white border-b border-slate-100 relative">
      <div class="absolute inset-x-0 top-0 h-1 top-accent"></div>
      <div class="flex items-center gap-2">
        <div class="w-8 h-8 rounded-xl flex items-center justify-center bg-blue-50 text-blue-700 font-bold">TS</div>
        <span class="text-sm font-semibold text-slate-800">TripSafe</span>
        <span class="ml-2 text-[10px] text-slate-400">Demo</span>
      </div>
      <div class="flex items-center gap-2">
        <button id="langBtn" class="text-xs font-semibold px-3 py-1.5 rounded-full bg-slate-100 hover:bg-slate-200 btn">EN</button>
        <button id="offlineToggle" class="text-xs font-semibold px-3 py-1.5 rounded-full bg-green-50 text-green-700 hover:bg-green-100 btn">Online</button>
      </div>
    </header>

    <main id="screens" class="relative">
      <!-- Splash -->
      <section id="screen-splash" class="min-h-[640px] flex flex-col items-center justify-between p-8 bg-white">
        <div></div>
        <div class="text-center">
          <div class="mx-auto mb-6 w-20 h-20 rounded-2xl glow-btn shadow-lg flex items-center justify-center">
            <span class="text-3xl">ğŸ›¡ï¸</span>
          </div>
          <h1 class="text-3xl font-extrabold text-slate-900 tracking-tight">TripSafe</h1>
          <p class="mt-2 text-sm text-slate-600" data-i18n="tagline">Your Safety, Our Priority</p>
          <p class="mt-6 text-xs text-slate-500 max-w-[18rem] mx-auto">Modern, trusted safety companion for tourists.</p>
        </div>
        <div class="w-full">
          <button id="getStarted" class="btn w-full py-3 rounded-2xl glow-btn text-white font-semibold">Get Started</button>
          <p class="text-[11px] text-center text-slate-500 mt-3">By continuing you accept demo terms</p>
        </div>
      </section>

      <!-- Auth -->
      <section id="screen-auth" class="hidden min-h-[640px] p-5 bg-white">
        <div class="text-center mt-3 mb-6">
          <h2 class="text-2xl font-extrabold text-slate-900" data-i18n="welcome">Welcome</h2>
          <p class="text-sm text-slate-500" data-i18n="signinOrCreate">Sign in or create your TripSafe profile</p>
        </div>

        <div class="segmented grid grid-cols-2 bg-slate-100 rounded-xl p-1 mb-5">
          <input type="radio" id="tabLogin" name="authTab" class="hidden" checked>
          <label for="tabLogin" class="text-center text-sm font-semibold py-2 rounded-lg cursor-pointer select-none" data-i18n="login">Login</label>
          <input type="radio" id="tabSignup" name="authTab" class="hidden">
          <label for="tabSignup" class="text-center text-sm font-semibold py-2 rounded-lg cursor-pointer select-none" data-i18n="signup">Sign up</label>
        </div>

        <!-- Login -->
        <form id="loginForm" class="space-y-3">
          <div class="flex items-center gap-3 p-3 rounded-xl border border-slate-200">
            <span class="text-xl">ğŸªª</span>
            <input id="loginTouristId" type="text" placeholder="Tourist ID" class="w-full outline-none text-sm" required>
          </div>
          <div class="flex items-center gap-3 p-3 rounded-xl border border-slate-200">
            <span class="text-xl">ğŸ”’</span>
            <input id="loginPassword" type="password" placeholder="Password (or leave empty for OTP)" class="w-full outline-none text-sm">
          </div>
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-2">
              <input id="loginOtp" type="checkbox" class="rounded">
              <label for="loginOtp" class="text-xs text-slate-600" data-i18n="useOtp">Use OTP instead</label>
            </div>
            <button type="button" class="text-xs font-semibold text-blue-700">Forgot?</button>
          </div>
          <button type="submit" class="btn w-full py-3 rounded-2xl glow-btn text-white font-semibold" data-i18n="login">Login</button>
          <button id="loginSendOtp" type="button" class="btn w-full py-3 rounded-2xl bg-blue-50 text-blue-700 font-semibold" data-i18n="sendOtp">Send OTP</button>
        </form>

        <!-- Signup -->
        <form id="signupForm" class="hidden space-y-3 mt-2">
          <div class="flex items-center gap-3 p-3 rounded-xl border border-slate-200">
            <span class="text-xl">ğŸ‘¤</span>
            <input id="suName" type="text" placeholder="Full Name" class="w-full outline-none text-sm" required>
          </div>
          <div class="flex items-center gap-3 p-3 rounded-xl border border-slate-200">
            <span class="text-xl">ğŸŒ</span>
            <input id="suFrom" type="text" placeholder="From (City / State)" class="w-full outline-none text-sm" required>
          </div>
          <div class="flex items-center gap-3 p-3 rounded-xl border border-slate-200 justify-between">
            <div class="flex items-center gap-3">
              <span class="text-xl">ğŸ§¾</span>
              <span class="text-sm text-slate-700" data-i18n="idUpload">Identity Proof</span>
            </div>
            <button type="button" id="idUpload" class="text-xs font-semibold px-3 py-2 rounded-lg bg-slate-100" data-i18n="upload">Upload</button>
          </div>
          <div class="flex items-center gap-3 p-3 rounded-xl border border-slate-200">
            <span class="text-xl">ğŸ“±</span>
            <input id="suMobile" type="tel" placeholder="Mobile Number" class="w-full outline-none text-sm" required>
          </div>
          <div class="flex items-center gap-3 p-3 rounded-xl border border-slate-200">
            <span class="text-xl">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§</span>
            <input id="suGuardian" type="tel" placeholder="Guardian Contact" class="w-full outline-none text-sm" required>
          </div>
          <div class="flex items-center gap-3 p-3 rounded-xl border border-slate-200 justify-between">
            <div class="flex items-center gap-3">
              <span class="text-xl">ğŸ¤³</span>
              <span class="text-sm text-slate-700" data-i18n="faceVerify">Face Verification</span>
            </div>
            <button type="button" id="faceVerify" class="text-xs font-semibold px-3 py-2 rounded-lg bg-slate-100" data-i18n="start">Start</button>
          </div>
          <div class="flex items-center gap-3 p-3 rounded-xl border border-slate-200">
            <span class="text-xl">ğŸ”¢</span>
            <div class="flex gap-2 w-full">
              <input id="suOtp" type="text" inputmode="numeric" maxlength="6" placeholder="Enter OTP" class="w-full outline-none text-sm">
              <button type="button" id="sendSignupOtp" class="text-xs font-semibold px-3 py-2 rounded-lg bg-blue-50 text-blue-700" data-i18n="sendOtp">Send OTP</button>
            </div>
          </div>
          <button type="submit" class="btn w-full py-3 rounded-2xl glow-btn text-white font-semibold" data-i18n="createAccount">Create Account</button>
        </form>

        <p class="text-[11px] text-center text-slate-500 mt-4">Demo only: uploads/selfies mocked.</p>
      </section>

      <!-- Dashboard -->
      <section id="screen-dashboard" class="hidden min-h-[640px] bg-white">
        <div class="relative h-40 bg-slate-100 overflow-hidden">
          <div class="absolute inset-0">
            <div class="absolute inset-0">
              <div class="absolute top-0 left-0 right-0 h-1/2 safe-shade"></div>
              <div class="absolute bottom-0 left-0 right-0 h-1/2 map-hatch"></div>
            </div>
            <svg class="absolute inset-0 w-full h-full" viewBox="0 0 400 200" preserveAspectRatio="none">
              <defs>
                <marker id="arrow" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto">
                  <polygon points="0 0, 6 3, 0 6" fill="#1e40af"></polygon>
                </marker>
              </defs>
              <path d="M20,180 C80,120 160,140 220,110 C280,80 320,60 380,30" fill="none" stroke="#2563eb" stroke-width="3" marker-end="url(#arrow)"/>
              <circle cx="20" cy="180" r="6" fill="#10b981"></circle>
              <circle cx="380" cy="30" r="6" fill="#ef4444"></circle>
            </svg>
            <div class="absolute left-6 bottom-8 px-2 py-1 text-[11px] bg-white/90 rounded-md shadow">You are here ğŸ“</div>
            <div class="absolute right-4 top-4 px-2 py-1 text-[11px] bg-white/90 rounded-md shadow">Planned route âœ</div>
          </div>
          <button id="openMap" class="absolute right-3 bottom-3 text-xs font-semibold px-3 py-1.5 rounded-full glow-btn text-white btn" data-i18n="openMap">Open Map</button>
        </div>

        <div class="px-5 py-4">
          <div class="relative mx-auto w-40 h-40">
            <div class="pulse-ring pointer-events-none"></div>
            <button id="sosBtn" class="btn w-full h-full rounded-full bg-red-600 text-white font-extrabold text-3xl shadow-xl hover:bg-red-700 focus:outline-none sos-shine">SOS</button>
          </div>
          <p class="text-center text-xs text-slate-500 mt-3" data-i18n="sosSub">One tap to alert police and guardians</p>
        </div>

        <div class="grid grid-cols-2 gap-3 px-5">
          <button id="tileEmergency" class="tile p-4 rounded-2xl border border-slate-200 text-left bg-white">
            <div class="text-2xl">ğŸš¨</div>
            <div class="mt-2 font-semibold text-slate-800 text-sm" data-i18n="emergencyNumbers">Emergency Numbers</div>
            <div class="text-[11px] text-slate-500">Police â€¢ Ambulance â€¢ Fire</div>
          </button>

          <div class="tile p-4 rounded-2xl border border-slate-200 bg-white">
            <div class="flex items-center justify-between">
              <div>
                <div class="text-2l text-2xl">ğŸ§­</div>
                <div class="mt-2 font-semibold text-slate-800 text-sm" data-i18n="guardianMode">Guardian Mode</div>
                <div class="text-[11px] text-slate-500" data-i18n="familyTracking">Family tracking</div>
              </div>
              <label class="inline-flex items-center cursor-pointer">
                <input id="toggleGuardian" type="checkbox" class="sr-only">
                <span class="w-11 h-6 bg-slate-200 rounded-full relative transition">
                  <span id="guardianKnob" class="absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full shadow transition"></span>
                </span>
              </label>
            </div>
            <div id="guardianLive" class="hidden mt-3 text-xs text-green-700 bg-green-50 rounded-lg px-2 py-1 badge">Live tracking enabled âœ…</div>
          </div>

          <div class="tile p-4 rounded-2xl border border-slate-200 bg-white">
            <div class="flex items-center justify-between">
              <div>
                <div class="text-2xl">ğŸ“¤</div>
                <div class="mt-2 font-semibold text-slate-800 text-sm" data-i18n="autoShare">Auto Location Share</div>
                <div class="text-[11px] text-slate-500" data-i18n="autoShareSub">Share if no response</div>
              </div>
              <label class="inline-flex items-center cursor-pointer">
                <input id="toggleAutoShare" type="checkbox" class="sr-only">
                <span class="w-11 h-6 bg-slate-200 rounded-full relative transition">
                  <span id="autoShareKnob" class="absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full shadow transition"></span>
                </span>
              </label>
            </div>
            <div id="autoShareHint" class="hidden mt-3 text-xs text-blue-700 bg-blue-50 rounded-lg px-2 py-1 badge">If no reply in 10 min, location will be sent</div>
          </div>

          <button id="tileSafetyFeed" class="tile p-4 rounded-2xl border border-slate-200 text-left bg-white">
            <div class="text-2xl">ğŸ“°</div>
            <div class="mt-2 font-semibold text-slate-800 text-sm" data-i18n="safetyFeed">Safety Feed</div>
            <div class="text-[11px] text-slate-500" data-i18n="latestNearby">Latest nearby incidents</div>
          </button>
        </div>

        <div class="px-5 pt-4 pb-6">
          <div class="p-4 rounded-2xl border border-slate-200 bg-white">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-2">
                <span class="text-2xl">ğŸ“</span>
                <div>
                  <div class="font-semibold text-slate-800 text-sm">Calls</div>
                  <div class="text-[11px] text-slate-500">Audio / Video</div>
                </div>
              </div>
              <div class="flex gap-2">
                <button id="openAudio" class="px-3 py-1.5 rounded-lg bg-green-600 text-white text-xs font-semibold">Audio</button>
                <button id="openVideo" class="px-3 py-1.5 rounded-lg bg-blue-600 text-white text-xs font-semibold">Video</button>
              </div>
            </div>
          </div>
        </div>

        <div class="px-5 pb-5 flex items-center justify-between text-xs">
          <button id="tileProfile" class="px-3 py-2 rounded-xl bg-slate-100 font-semibold">Profile</button>
          <button id="tileAlerts" class="px-3 py-2 rounded-xl bg-slate-100 font-semibold">Alerts</button>
          <button id="tileChat" class="px-3 py-2 rounded-xl bg-slate-100 font-semibold">Chat</button>
          <div class="text-[11px] text-slate-400">v0.4 Demo</div>
        </div>
      </section>

      <!-- Live Map -->
      <section id="screen-map" class="hidden min-h-[640px] flex flex-col bg-white">
        <div class="flex items-center justify-between px-4 py-3 border-b border-slate-100">
          <button class="text-sm font-semibold px-3 py-1.5 rounded-full bg-slate-100" data-back="dashboard">â† Back</button>
          <div class="text-sm font-semibold">Live Map</div>
          <div class="text-[11px] text-slate-500">Demo</div>
        </div>
        <div class="relative flex-1">
          <div class="absolute inset-0 bg-slate-100 overflow-hidden">
            <div class="absolute inset-0">
              <div class="absolute inset-6 rounded-3xl safe-shade"></div>
              <div class="absolute left-10 top-16 right-10 bottom-20 rounded-3xl map-hatch"></div>
            </div>
            <span class="absolute left-6 top-6 text-[11px] bg-green-600 text-white px-2 py-0.5 rounded">Safe Zone</span>
            <span class="absolute right-6 bottom-24 text-[11px] bg-red-600 text-white px-2 py-0.5 rounded">High-Risk</span>
            <div class="absolute left-8 bottom-16 px-2 py-1 text-xs bg-white rounded-md shadow">ğŸ¥ Hospital</div>
            <div class="absolute right-8 top-28 px-2 py-1 text-xs bg-white rounded-md shadow">ğŸ‘® Police</div>
            <div class="absolute left-1/2 -translate-x-1/2 top-10 px-2 py-1 text-xs bg-white rounded-md shadow">ğŸšŒ Transport</div>
            <svg class="absolute inset-0 w-full h-full" viewBox="0 0 400 640" preserveAspectRatio="none">
              <path d="M40,600 C120,520 180,520 240,460 C300,400 340,340 360,200" fill="none" stroke="#2563eb" stroke-width="4" stroke-dasharray="6 6"/>
            </svg>
            <div class="absolute left-9 bottom-12">
              <div class="relative">
                <div class="pulse-ring"></div>
                <div class="w-6 h-6 rounded-full bg-blue-600 border-2 border-white shadow"></div>
              </div>
              <div class="mt-1 text-[11px] text-slate-600">You</div>
            </div>
          </div>

          <div id="geofenceBanner" class="hidden absolute left-4 right-4 top-4 bg-red-50 text-red-700 text-xs rounded-xl px-3 py-2 shadow">
            âš ï¸ High-Risk Zone detected. Stay alert. Route updated.
          </div>

          <div class="absolute left-4 right-4 bottom-4 grid grid-cols-2 gap-3">
            <button id="simulateFence" class="btn bg-red-600 text-white rounded-xl py-3 font-semibold">Simulate Geo-Fence</button>
            <button id="openIncident" class="btn glow-btn text-white rounded-xl py-3 font-semibold">Area Info</button>
          </div>
        </div>
      </section>

      <!-- Safety Feed -->
      <section id="screen-feed" class="hidden min-h-[640px] flex flex-col bg-white">
        <div class="flex items-center justify-between px-4 py-3 border-b border-slate-100">
          <button class="text-sm font-semibold px-3 py-1.5 rounded-full bg-slate-100" data-back="dashboard">â† Back</button>
          <div class="text-sm font-semibold">Safety Feed</div>
          <div class="text-[11px] text-slate-500">Live</div>
        </div>
        <div id="feedList" class="p-4 space-y-3"></div>
      </section>

      <!-- Incident & Area Info -->
      <section id="screen-incident" class="hidden min-h-[640px] flex flex-col bg-white">
        <div class="flex items-center justify-between px-4 py-3 border-b border-slate-100">
          <button class="text-sm font-semibold px-3 py-1.5 rounded-full bg-slate-100" data-back="map">â† Back</button>
          <div class="text-sm font-semibold">Area Safety</div>
          <div class="text-[11px] text-slate-500">Demo</div>
        </div>
        <div class="p-5 space-y-4">
          <div class="p-4 rounded-2xl bg-slate-50 border border-slate-100">
            <div class="flex items-center justify-between">
              <div>
                <div class="text-xs text-slate-500">Safety Score</div>
                <div id="safetyScore" class="text-2xl font-extrabold text-slate-900">--</div>
              </div>
              <div id="safetyIcon" class="text-green-600 text-xl">ğŸŸ¢</div>
            </div>
            <p class="text-xs text-slate-500 mt-2">AI-based rating from recent reports</p>
          </div>

          <div class="space-y-2">
            <h3 class="text-sm font-bold text-slate-800">Recent Incidents</h3>
            <div id="incidentList" class="space-y-2 max-h-40 overflow-auto pr-1"></div>
          </div>

          <div class="space-y-2">
            <h3 class="text-sm font-bold text-slate-800">Tourist Info</h3>
            <ul class="text-xs text-slate-600 list-disc pl-5 space-y-1" id="touristTips"></ul>
          </div>

          <button id="toProfileFromIncident" class="btn w-full py-3 rounded-xl bg-slate-100 font-semibold">View My Profile</button>
        </div>
      </section>

      <!-- Profile -->
      <section id="screen-profile" class="hidden min-h-[640px] flex flex-col bg-white">
        <div class="flex items-center justify-between px-4 py-3 border-b border-slate-100">
          <button class="text-sm font-semibold px-3 py-1.5 rounded-full bg-slate-100" data-back="dashboard">â† Back</button>
          <div class="text-sm font-semibold">My Profile</div>
          <div class="text-[11px] text-slate-500">ID</div>
        </div>
        <div class="p-5 space-y-4">
          <div class="flex items-center gap-3">
            <div class="w-14 h-14 rounded-2xl bg-blue-100 flex items-center justify-center text-2xl" id="profilePhoto">ğŸ™‚</div>
            <div>
              <div class="font-bold text-slate-800" id="profileName">Alex Traveler</div>
              <div class="text-xs text-slate-500" id="profileFrom">From: Pune, Maharashtra</div>
            </div>
          </div>

          <div class="p-4 rounded-2xl border border-slate-200">
            <div class="flex items-center justify-between">
              <div class="text-sm font-semibold text-slate-800">Digital Tourist ID</div>
              <span class="text-xs text-slate-500">QR</span>
            </div>
            <div class="mt-3 flex items-center justify-center">
              <svg width="140" height="140" viewBox="0 0 100 100" class="rounded-lg border border-slate-200">
                <rect width="100" height="100" fill="#fff"/>
                <rect x="6" y="6" width="24" height="24" fill="#111827"/>
                <rect x="70" y="6" width="24" height="24" fill="#111827"/>
                <rect x="6" y="70" width="24" height="24" fill="#111827"/>
                <rect x="36" y="36" width="6" height="6" fill="#111827"/>
                <rect x="46" y="36" width="8" height="8" fill="#111827"/>
                <rect x="60" y="36" width="6" height="6" fill="#111827"/>
                <rect x="36" y="48" width="6" height="6" fill="#111827"/>
                <rect x="52" y="52" width="14" height="14" fill="#111827"/>
                <rect x="36" y="60" width="6" height="6" fill="#111827"/>
                <rect x="60" y="60" width="6" height="6" fill="#111827"/>
                <rect x="80" y="48" width="6" height="6" fill="#111827"/>
                <rect x="48" y="80" width="10" height="10" fill="#111827"/>
              </svg>
            </div>
            <p class="text-center text-[11px] text-slate-500 mt-2">Show this to authorities if needed</p>
          </div>

          <div class="p-4 rounded-2xl border border-slate-200 space-y-2">
            <div class="text-sm font-bold text-slate-800">Emergency Contacts</div>
            <div class="flex items-center justify-between text-sm">
              <span class="text-slate-700">Parent</span>
              <button class="px-3 py-1.5 rounded-lg bg-slate-100 text-xs font-semibold">Call</button>
            </div>
            <div class="flex items-center justify-between text-sm">
              <span class="text-slate-700">Relative</span>
              <button class="px-3 py-1.5 rounded-lg bg-slate-100 text-xs font-semibold">Call</button>
            </div>
          </div>

          <div class="p-4 rounded-2xl border border-slate-200 space-y-3">
            <div class="flex items-center justify-between">
              <div class="text-sm font-semibold text-slate-800">Language</div>
              <button id="profileLang" class="px-3 py-1.5 rounded-lg bg-slate-100 text-xs font-semibold">EN</button>
            </div>
            <div class="flex items-center justify-between">
              <div class="text-sm font-semibold text-slate-800">Check-in Reminders</div>
              <label class="inline-flex items-center cursor-pointer">
                <input id="toggleCheckin" type="checkbox" class="sr-only">
                <span class="w-11 h-6 bg-slate-200 rounded-full relative transition">
                  <span id="checkinKnob" class="absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full shadow transition"></span>
                </span>
              </label>
            </div>
            <div id="checkinHint" class="hidden text-xs text-green-700 bg-green-50 rounded-lg px-2 py-1 badge">Daily check-in at 8pm enabled</div>
          </div>
        </div>
      </section>

      <!-- Alerts -->
      <section id="screen-alerts" class="hidden min-h-[640px] flex flex-col bg-white">
        <div class="flex items-center justify-between px-4 py-3 border-b border-slate-100">
          <button class="text-sm font-semibold px-3 py-1.5 rounded-full bg-slate-100" data-back="dashboard">â† Back</button>
          <div class="text-sm font-semibold">Alerts</div>
          <div class="text-[11px] text-slate-500">Demo</div>
        </div>
        <div id="alertsList" class="p-4 space-y-3"></div>
      </section>

      <!-- My Complaints -->
      <section id="screen-mycomplaints" class="hidden min-h-[640px] flex flex-col bg-white">
        <div class="flex items-center justify-between px-4 py-3 border-b border-slate-100">
          <button class="text-sm font-semibold px-3 py-1.5 rounded-full bg-slate-100" data-back="dashboard">â† Back</button>
          <div class="text-sm font-semibold">Your Complaints</div>
          <div class="text-[11px] text-slate-500">Demo</div>
        </div>
        <div id="complaintsList" class="p-4 space-y-3"></div>
      </section>

      <!-- Chat -->
      <section id="screen-chat" class="hidden min-h-[640px] flex flex-col bg-white">
        <div class="flex items-center justify-between px-4 py-3 border-b border-slate-100">
          <button class="text-sm font-semibold px-3 py-1.5 rounded-full bg-slate-100" data-back="dashboard">â† Back</button>
          <div class="text-sm font-semibold">Guardian Chat</div>
          <div class="text-[11px] text-slate-500">Demo</div>
        </div>
        <div id="chatThread" class="flex-1 p-4 space-y-2 overflow-auto chat-scroll bg-slate-50"></div>
        <form id="chatForm" class="p-3 flex items-center gap-2 border-t border-slate-100">
          <input id="chatInput" class="flex-1 px-3 py-2 rounded-xl bg-white border border-slate-200 text-sm outline-none" placeholder="Type a message...">
          <button class="px-3 py-2 rounded-xl glow-btn text-white text-sm font-semibold btn">Send</button>
        </form>
      </section>

      <!-- Calls UI -->
      <section id="screen-call" class="hidden min-h-[640px] flex flex-col bg-white">
        <div class="flex items-center justify-between px-4 py-3 border-b border-slate-100">
          <button class="text-sm font-semibold px-3 py-1.5 rounded-full bg-slate-100" data-back="dashboard">â† Back</button>
          <div id="callTitle" class="text-sm font-semibold">Audio Call</div>
          <div class="text-[11px] text-slate-500">Demo</div>
        </div>
        <div class="flex-1 flex flex-col items-center justify-center p-6">
          <div id="videoPreview" class="hidden w-64 h-40 rounded-2xl bg-slate-200 mb-6 flex items-center justify-center text-slate-600">Video Preview</div>
          <div class="w-24 h-24 rounded-full bg-blue-100 flex items-center justify-center text-4xl call-anim">ğŸ‘¤</div>
          <div class="mt-3 text-sm text-slate-600">Calling Guardian...</div>
          <div class="mt-6 flex gap-3">
            <button id="btnMute" class="px-4 py-2 rounded-full bg-slate-100 font-semibold btn">Mute</button>
            <button id="btnCam" class="hidden px-4 py-2 rounded-full bg-slate-100 font-semibold btn">Camera Off</button>
            <button id="btnEnd" class="px-4 py-2 rounded-full bg-red-600 text-white font-semibold btn">End</button>
          </div>
        </div>
      </section>

      <!-- Register Complaint -->
      <section id="screen-complaint" class="hidden min-h-[640px] flex flex-col bg-white">
        <div class="flex items-center justify-between px-4 py-3 border-b border-slate-100">
          <button class="text-sm font-semibold px-3 py-1.5 rounded-full bg-slate-100" data-back="dashboard">â† Back</button>
          <div class="text-sm font-semibold">Register Complaint</div>
          <div class="text-[11px] text-slate-500">Demo</div>
        </div>
        <form id="complaintForm" class="p-5 space-y-3">
          <div>
            <label class="text-xs text-slate-600">Category</label>
            <select id="complaintCat" class="mt-1 w-full px-3 py-2 rounded-xl bg-white border border-slate-200 text-sm">
              <option>Minor Theft</option>
              <option>Harassment</option>
              <option>Lost Item</option>
              <option>Medical Emergency</option>
              <option>Other</option>
            </select>
          </div>
          <div>
            <label class="text-xs text-slate-600">Description</label>
            <textarea id="complaintDesc" rows="4" class="mt-1 w-full px-3 py-2 rounded-xl bg-white border border-slate-200 text-sm" placeholder="Describe what happened..."></textarea>
          </div>
          <div class="flex items-center justify-between p-3 rounded-xl border border-slate-200">
            <div class="flex items-center gap-2 text-sm text-slate-700"><span>ğŸ“</span>Attach Photo (Demo)</div>
            <button id="complaintAttach" type="button" class="px-3 py-1.5 rounded-lg bg-slate-100 text-xs font-semibold">Upload</button>
          </div>
          <div class="flex items-center justify-between">
            <div class="text-sm text-slate-700">Share current location</div>
            <label class="inline-flex items-center cursor-pointer">
              <input id="complaintShareLoc" type="checkbox" class="sr-only" checked>
              <span class="w-11 h-6 bg-slate-200 rounded-full relative transition">
                <span id="complaintLocKnob" class="absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full shadow transition"></span>
              </span>
            </label>
          </div>
          <button class="btn w-full py-3 rounded-2xl glow-btn text-white font-semibold">Submit Complaint</button>
          <p class="text-[11px] text-slate-500">Demo only: sent to mocked endpoint.</p>
        </form>
      </section>

      <!-- Modals -->
      <div id="modalEmergency" class="hidden absolute inset-0 bg-black/40 flex items-end sm:items-center justify-center p-4">
        <div class="w-full max-w-sm bg-white rounded-2xl p-4 space-y-3">
          <div class="flex items-center justify-between">
            <div class="text-sm font-bold text-slate-800">Emergency Numbers</div>
            <button id="closeEmergency" class="text-xs px-2 py-1.5 rounded-lg bg-slate-100">âœ•</button>
          </div>
          <div class="grid grid-cols-3 gap-2">
            <button class="p-3 rounded-xl bg-red-50 text-red-700 text-sm font-semibold call-number" data-target="police">Police</button>
            <button class="p-3 rounded-xl bg-red-50 text-red-700 text-sm font-semibold call-number" data-target="ambulance">Ambulance</button>
            <button class="p-3 rounded-xl bg-red-50 text-red-700 text-sm font-semibold call-number" data-target="fire">Fire</button>
          </div>
          <p class="text-[11px] text-slate-500">Demo only: calls mocked.</p>
        </div>
      </div>

      <div id="modalSOS" class="hidden absolute inset-0 bg-black/50 flex items-center justify-center p-4">
        <div class="w-full max-w-sm bg-white rounded-2xl p-5 space-y-3">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-xl bg-red-600 text-white flex items-center justify-center text-xl">ğŸš¨</div>
            <div>
              <div class="font-bold text-slate-900">SOS Activated</div>
              <div class="text-xs text-slate-600">Calling police... sharing location</div>
            </div>
          </div>
          <div class="grid grid-cols-2 gap-2">
            <button id="sosCancel" class="btn py-2 rounded-xl bg-slate-100 font-semibold">Cancel</button>
            <button id="sosConfirm" class="btn py-2 rounded-xl bg-red-600 text-white font-semibold">Confirm</button>
          </div>
          <p class="text-[11px] text-slate-500">Demo only: no real calls.</p>
        </div>
      </div>

      <!-- Toast -->
      <div id="toast" class="hidden absolute left-1/2 -translate-x-1/2 bottom-5 bg-slate-900 text-white text-xs px-3 py-2 rounded-full shadow-lg"></div>
    </main>

    <!-- Always-on Floating Buttons (visible after login) -->
    <div id="floating" class="floating-overlay hidden">
      <div class="floating-controls">
        <button id="botFab" class="px-4 py-3 rounded-full glow-btn text-white shadow-lg btn">ğŸ¤–</button>
        <div class="flex items-end gap-3">
          <div id="plusMenu" class="hidden w-60 bg-white rounded-2xl p-2 trust-card menu-pop">
            <button id="menuRegister" class="w-full flex items-center gap-3 p-3 rounded-xl hover:bg-slate-50">
              <span class="w-8 h-8 rounded-xl flex items-center justify-center bg-amber-100 text-amber-700">ğŸ“</span>
              <div class="text-left">
                <div class="text-sm font-semibold text-slate-800">Register Complaint</div>
                <div class="text-[11px] text-slate-500">File a report</div>
              </div>
            </button>
            <button id="menuMyComplaints" class="mt-1 w-full flex items-center gap-3 p-3 rounded-xl hover:bg-slate-50">
              <span class="w-8 h-8 rounded-xl flex items-center justify-center bg-teal-100 text-teal-700">ğŸ“‚</span>
              <div class="text-left">
                <div class="text-sm font-semibold text-slate-800">Your Complaints</div>
                <div class="text-[11px] text-slate-500">View status & details</div>
              </div>
            </button>
          </div>
          <button id="plusFab" aria-label="More actions" class="w-12 h-12 rounded-full glow-btn text-white text-2xl shadow-lg btn">+</button>
        </div>
      </div>
    </div>

    <!-- AI Bot Panel -->
    <div id="botPanel" class="hidden absolute inset-0 bg-black/30 flex items-end p-4 z-30">
      <div class="w-full max-w-sm bg-white rounded-2xl overflow-hidden trust-card">
        <div class="flex items-center justify-between px-4 py-3 border-b border-slate-100">
          <div class="font-semibold">Ask TripSafe Bot</div>
          <button id="botClose" class="text-xs px-2 py-1.5 rounded-lg bg-slate-100">âœ•</button>
        </div>
        <div id="botMessages" class="h-72 overflow-auto p-3 space-y-2 bg-slate-50 chat-scroll">
          <div class="text-xs text-slate-600">Hi! Ask me safety tips, translate phrases, or say â€œIâ€™m lostâ€.</div>
        </div>
        <form id="botForm" class="p-3 flex items-center gap-2 border-t border-slate-100">
          <select id="botLang" class="px-2 py-2 rounded-lg bg-white border border-slate-200 text-xs">
            <option value="EN">EN</option>
            <option value="HI">HI</option>
          </select>
          <input id="botInput" class="flex-1 px-3 py-2 rounded-xl bg-white border border-slate-200 text-sm outline-none" placeholder="Type your question...">
          <button class="px-3 py-2 rounded-xl glow-btn text-white text-sm font-semibold btn">Ask</button>
        </form>
      </div>
    </div>
  </div>

<script>
/* -------------------- i18n (EN, HI) -------------------- */
const i18n = {
  EN: {
    tagline: "Your Safety, Our Priority",
    getStarted: "Get Started",
    welcome: "Welcome",
    signinOrCreate: "Sign in or create your TripSafe profile",
    login: "Login",
    signup: "Sign up",
    sendOtp: "Send OTP",
    idUpload: "Identity Proof",
    upload: "Upload",
    faceVerify: "Face Verification",
    start: "Start",
    createAccount: "Create Account",
    useOtp: "Use OTP instead",
    openMap: "Open Map",
    sosSub: "One tap to alert police and guardians",
    emergencyNumbers: "Emergency Numbers",
    guardianMode: "Guardian Mode",
    familyTracking: "Family tracking",
    autoShare: "Auto Location Share",
    autoShareSub: "Share if no response",
    safetyFeed: "Safety Feed",
    latestNearby: "Latest nearby incidents",
  },
  HI: {
    tagline: "à¤†à¤ªà¤•à¥€ à¤¸à¥à¤°à¤•à¥à¤·à¤¾, à¤¹à¤®à¤¾à¤°à¥€ à¤ªà¥à¤°à¤¾à¤¥à¤®à¤¿à¤•à¤¤à¤¾",
    getStarted: "à¤¶à¥à¤°à¥‚ à¤•à¤°à¥‡à¤‚",
    welcome: "à¤¸à¥à¤µà¤¾à¤—à¤¤ à¤¹à¥ˆ",
    signinOrCreate: "à¤¸à¤¾à¤‡à¤¨ à¤‡à¤¨ à¤•à¤°à¥‡à¤‚ à¤¯à¤¾ à¤ªà¥à¤°à¥‹à¤«à¤¼à¤¾à¤‡à¤² à¤¬à¤¨à¤¾à¤à¤‚",
    login: "à¤²à¥‰à¤—à¤¿à¤¨",
    signup: "à¤¸à¤¾à¤‡à¤¨ à¤…à¤ª",
    sendOtp: "à¤“à¤Ÿà¥€à¤ªà¥€ à¤­à¥‡à¤œà¥‡à¤‚",
    idUpload: "à¤ªà¤¹à¤šà¤¾à¤¨ à¤ªà¤¤à¥à¤°",
    upload: "à¤…à¤ªà¤²à¥‹à¤¡",
    faceVerify: "à¤šà¥‡à¤¹à¤°à¤¾ à¤¸à¤¤à¥à¤¯à¤¾à¤ªà¤¨",
    start: "à¤¶à¥à¤°à¥‚ à¤•à¤°à¥‡à¤‚",
    createAccount: "à¤–à¤¾à¤¤à¤¾ à¤¬à¤¨à¤¾à¤à¤‚",
    useOtp: "à¤“à¤Ÿà¥€à¤ªà¥€ à¤•à¤¾ à¤‰à¤ªà¤¯à¥‹à¤— à¤•à¤°à¥‡à¤‚",
    openMap: "à¤®à¤¾à¤¨à¤šà¤¿à¤¤à¥à¤° à¤–à¥‹à¤²à¥‡à¤‚",
    sosSub: "à¤à¤• à¤Ÿà¥ˆà¤ª à¤®à¥‡à¤‚ à¤ªà¥à¤²à¤¿à¤¸ à¤”à¤° à¤…à¤­à¤¿à¤­à¤¾à¤µà¤•à¥‹à¤‚ à¤•à¥‹ à¤¸à¥‚à¤šà¤¿à¤¤ à¤•à¤°à¥‡à¤‚",
    emergencyNumbers: "à¤†à¤ªà¤¾à¤¤à¤•à¤¾à¤²à¥€à¤¨ à¤¨à¤‚à¤¬à¤°",
    guardianMode: "à¤—à¤¾à¤°à¥à¤¡à¤¿à¤¯à¤¨ à¤®à¥‹à¤¡",
    familyTracking: "à¤ªà¤°à¤¿à¤µà¤¾à¤° à¤Ÿà¥à¤°à¥ˆà¤•à¤¿à¤‚à¤—",
    autoShare: "à¤‘à¤Ÿà¥‹ à¤²à¥‹à¤•à¥‡à¤¶à¤¨ à¤¶à¥‡à¤¯à¤°",
    autoShareSub: "à¤•à¥‹à¤ˆ à¤œà¤µà¤¾à¤¬ à¤¨ à¤¹à¥‹ à¤¤à¥‹ à¤¸à¤¾à¤à¤¾ à¤•à¤°à¥‡à¤‚",
    safetyFeed: "à¤¸à¥à¤°à¤•à¥à¤·à¤¾ à¤«à¥€à¤¡",
    latestNearby: "à¤¨à¤œà¤¼à¤¦à¥€à¤•à¥€ à¤˜à¤Ÿà¤¨à¤¾à¤à¤",
  }
};
let currentLang = "EN";
function applyI18n() {
  document.querySelectorAll("[data-i18n]").forEach(el=>{
    const key = el.getAttribute("data-i18n");
    if(i18n[currentLang][key]) el.textContent = i18n[currentLang][key];
  });
  document.getElementById("langBtn").textContent = currentLang;
  const profileLang = document.getElementById("profileLang");
  if (profileLang) profileLang.textContent = currentLang;
}

/* -------------------- Mock API + Offline -------------------- */
let offlineMode = false;

const mockDB = {
  user: { name: "Alex Traveler", from: "Pune, Maharashtra" },
  feed: [
    { id:1, title:"Police advisory: crowded market today", date:"12 Aug", body:"Keep belongings close. Follow signage."},
    { id:2, title:"Traffic diversion on Central Ave", date:"11 Aug", body:"Expect delays; route adjusted in map."},
    { id:3, title:"Community event near Riverfront", date:"10 Aug", body:"Large crowds expected. Use east gate."},
  ],
  incidents: [
    { id:11, type:"Minor Theft", date:"12 Aug", level:"Low" },
    { id:12, type:"Road Protest", date:"10 Aug", level:"High" },
    { id:13, type:"Lost Item", date:"07 Aug", level:"Info" },
  ],
  messages: [
    { id:101, from:"guardian", text:"Reached hotel?", ts: Date.now()-1000*60*12, read:true },
  ]
};

const api = {
  async call(url, options={}){
    if(offlineMode) throw new Error("offline");
    await sleep(400);
    const { method="GET" } = options;
    if (url.startsWith("/api/auth/login") && method==="POST") {
      return { ok:true, json: async ()=>({ token:"demo-token", user: mockDB.user }) };
    }
    if (url.startsWith("/api/auth/signup") && method==="POST") {
      return { ok:true, json: async ()=>({ token:"demo-token", user: mockDB.user }) };
    }
    if (url.startsWith("/api/sos") && method==="POST") {
      return { ok:true, json: async ()=>({ status:"sent", notified:["police","guardian"] }) };
    }
    if (url.startsWith("/api/messages") && method==="GET") {
      return { ok:true, json: async ()=>({ items: mockDB.messages }) };
    }
    if (url.startsWith("/api/messages") && method==="POST") {
      const payload = JSON.parse(options.body||"{}");
      const msg = { id: Date.now(), from:"you", text: payload.text||"", ts: Date.now(), read:false };
      mockDB.messages.push(msg);
      setTimeout(()=> {
        mockDB.messages.push({ id: Date.now()+1, from:"guardian", text:"ğŸ‘", ts: Date.now()+1000, read:false });
        renderChat();
      }, 900);
      return { ok:true, json: async ()=>({ sent:true }) };
    }
    if (url.startsWith("/api/call") && method==="POST") {
      return { ok:true, json: async ()=>({ status:"signaling-ok" }) };
    }
    if (url.startsWith("/api/ai-bot") && method==="POST") {
      const payload = JSON.parse(options.body||"{}");
      const reply = botLogic(payload.text||"", payload.lang||"EN");
      return { ok:true, json: async ()=>({ reply }) };
    }
    if (url.startsWith("/api/feed") && method==="GET") {
      return { ok:true, json: async ()=>({ items: mockDB.feed }) };
    }
    if (url.startsWith("/api/area") && method==="GET") {
      const score = 4.2;
      return { ok:true, json: async ()=>({ score, incidents: mockDB.incidents, tips: [
        "Respect local dress codes at religious places.",
        "Avoid isolated areas after dark; prefer main roads.",
        "Keep emergency contacts quick-dial ready.",
        "Carry a copy of ID; keep originals safe."
      ]}) };
    }
    if (url.startsWith("/api/complaint") && method==="POST") {
      const payload = JSON.parse(options.body||"{}");
      const ref = "CMP-" + Math.floor(Math.random()*9999);
      const rec = {
        id: Date.now(), ref,
        category: payload.category, desc: payload.desc,
        createdAt: new Date().toISOString(),
        status: "Submitted",
        officer: { name: "Inspector Rao", department: "Tourist Police", phone: "+91-80000-12345" },
        details: { precinct: "Zone-3", sla: "24h", notes: "Pending initial review" }
      };
      complaintsStore.unshift(rec);
      return { ok:true, json: async ()=>({ status:"received", ref }) };
    }
    return { ok:false, json: async ()=>({ error:"not-found" }) };
  }
};

function sleep(ms){ return new Promise(r=>setTimeout(r, ms)); }

/* -------------------- Helpers -------------------- */
const $ = (q) => document.querySelector(q);
const $$ = (q) => Array.from(document.querySelectorAll(q));
function show(el){ el.classList.remove("hidden"); }
function hide(el){ el.classList.add("hidden"); }
function toast(msg){ const t=$("#toast"); t.textContent=msg; show(t); setTimeout(()=>hide(t), 2200); }

/* -------------------- Navigation -------------------- */
const screens = {
  splash: $("#screen-splash"),
  auth: $("#screen-auth"),
  dashboard: $("#screen-dashboard"),
  map: $("#screen-map"),
  feed: $("#screen-feed"),
  incident: $("#screen-incident"),
  profile: $("#screen-profile"),
  alerts: $("#screen-alerts"),
  chat: $("#screen-chat"),
  call: $("#screen-call"),
  complaint: $("#screen-complaint"),
  mycomplaints: $("#screen-mycomplaints"),
};
const topbar = $("#topbar");
function go(name){
  Object.values(screens).forEach(s=>hide(s));
  show(screens[name]);
  if (name==="splash"||name==="auth"){ hide(topbar); hideFloating(); }
  else { show(topbar); showFloating(); }
  // enter animation
  screens[name].classList.add("fade-enter");
  setTimeout(()=>{ screens[name].classList.add("fade-enter-active");
    setTimeout(()=>screens[name].classList.remove("fade-enter","fade-enter-active"),260);
  },10);
}

/* -------------------- Floating visibility -------------------- */
const floating = $("#floating");
function showFloating(){ show(floating); }
function hideFloating(){ hide(floating); }

/* -------------------- Init -------------------- */
go("splash");
applyI18n();

/* -------------------- Splash -------------------- */
$("#getStarted").addEventListener("click", ()=> go("auth"));

/* -------------------- Auth -------------------- */
const tabLogin=$("#tabLogin"), tabSignup=$("#tabSignup");
const loginForm=$("#loginForm"), signupForm=$("#signupForm");
function switchAuth(){
  if (tabLogin.checked){ show(loginForm); hide(signupForm); }
  else { hide(loginForm); show(signupForm); }
}
switchAuth();
tabLogin.addEventListener("change", switchAuth);
tabSignup.addEventListener("change", switchAuth);

$("#loginSendOtp").addEventListener("click", ()=> toast("OTP sent (demo)"));
$("#idUpload").addEventListener("click", ()=> toast("ID uploaded (demo)"));
$("#faceVerify").addEventListener("click", ()=> toast("Face verified (demo)"));
$("#sendSignupOtp").addEventListener("click", ()=> toast("OTP sent (demo)"));

loginForm.addEventListener("submit", async (e)=>{
  e.preventDefault();
  try{
    const res = await api.call("/api/auth/login",{ method:"POST", body: JSON.stringify({ id: $("#loginTouristId").value }) });
    if (res.ok){ const data=await res.json(); applyUser(data.user); go("dashboard"); toast("Welcome back!"); }
  }catch(err){
    toast("Offline: using cached profile");
    applyUser(mockDB.user);
    go("dashboard");
  }
});
signupForm.addEventListener("submit", async (e)=>{
  e.preventDefault();
  try{
    const res = await api.call("/api/auth/signup",{ method:"POST", body: JSON.stringify({ name: $("#suName").value }) });
    if (res.ok){ const data=await res.json(); applyUser(data.user); go("dashboard"); toast("Account created!"); }
  }catch(err){
    toast("Offline: profile saved locally");
    applyUser({ name: $("#suName").value, from: $("#suFrom").value });
    go("dashboard");
  }
});
function applyUser(u){
  $("#profileName").textContent = u.name || "Traveler";
  $("#profileFrom").textContent = "From: " + (u.from||"-");
}

/* -------------------- Language -------------------- */
function cycleLang(){ currentLang = currentLang==="EN"?"HI":"EN"; applyI18n(); }
$("#langBtn").addEventListener("click", cycleLang);
$("#profileLang").addEventListener("click", cycleLang);

/* -------------------- Offline Toggle -------------------- */
$("#offlineToggle").addEventListener("click", ()=>{
  offlineMode = !offlineMode;
  const b = $("#offlineToggle");
  if (offlineMode){ b.textContent="Offline"; b.className="text-xs font-semibold px-3 py-1.5 rounded-full bg-red-50 text-red-700 hover:bg-red-100 btn"; toast("Offline mode: SMS fallback enabled"); }
  else { b.textContent="Online"; b.className="text-xs font-semibold px-3 py-1.5 rounded-full bg-green-50 text-green-700 hover:bg-green-100 btn"; toast("Back online"); }
});

/* -------------------- Dashboard actions -------------------- */
$("#openMap").addEventListener("click", ()=> go("map"));
$("#tileSafetyFeed").addEventListener("click", ()=> { loadFeed(); go("feed"); });
$("#tileProfile").addEventListener("click", ()=> go("profile"));
$("#tileAlerts").addEventListener("click", ()=> { loadAlerts(); go("alerts"); });
$("#tileChat").addEventListener("click", ()=> { renderChat(); go("chat"); });

$("#tileEmergency").addEventListener("click", ()=> show($("#modalEmergency")));
$("#closeEmergency").addEventListener("click", ()=> hide($("#modalEmergency")));
$$(".call-number").forEach(btn=>{
  btn.addEventListener("click", async ()=>{
    try{
      await api.call("/api/call",{ method:"POST", body: JSON.stringify({ target: btn.dataset.target })});
      toast("Dialling " + btn.dataset.target);
    }catch(e){ toast("Offline: cannot place call"); }
  });
});

/* Guardian toggle */
const toggleGuardian=$("#toggleGuardian"), guardianKnob=$("#guardianKnob"), guardianLive=$("#guardianLive");
toggleGuardian.addEventListener("change", ()=>{
  if (toggleGuardian.checked){
    guardianKnob.style.left='1.375rem';
    guardianKnob.parentElement.style.background='rgba(16,185,129,.9)';
    show(guardianLive);
    toast("Guardian Mode ON");
  }else{
    guardianKnob.style.left='.125rem';
    guardianKnob.parentElement.style.background='';
    hide(guardianLive);
    toast("Guardian Mode OFF");
  }
});

/* Auto share */
const toggleAutoShare=$("#toggleAutoShare"), autoShareKnob=$("#autoShareKnob"), autoShareHint=$("#autoShareHint");
let autoShareTimer=null;
toggleAutoShare.addEventListener("change", ()=>{
  if (toggleAutoShare.checked){
    autoShareKnob.style.left='1.375rem';
    autoShareKnob.parentElement.style.background='rgba(59,130,246,.9)';
    show(autoShareHint);
    toast("Auto Share ON");
    autoShareTimer = setTimeout(()=> {
      if (toggleAutoShare.checked){
        addAlert({ title:"Auto Location Share", ts:"Now", body:"No reply in 10 minutes. Location shared with guardians.", type:"info" });
        go("alerts");
        loadAlerts();
        toast("Location auto-shared");
      }
    }, 10000);
  }else{
    autoShareKnob.style.left='.125rem';
    autoShareKnob.parentElement.style.background='';
    hide(autoShareHint);
    if (autoShareTimer) clearTimeout(autoShareTimer);
    toast("Auto Share OFF");
  }
});

/* SOS Flow */
$("#sosBtn").addEventListener("click", ()=> show($("#modalSOS")));
$("#sosCancel").addEventListener("click", ()=> hide($("#modalSOS")));
$("#sosConfirm").addEventListener("click", async ()=>{
  hide($("#modalSOS"));
  const location = { lat: 18.5204, lng: 73.8567 };
  try{
    const res = await api.call("/api/sos",{ method:"POST", body: JSON.stringify({ location, contacts:["police","guardian"] }) });
    if (res.ok){
      toast("Location Shared with Police + Parents");
      addAlert({ title:"SOS Sent", ts:"Now", body:"Location shared with authorities and guardians.", type:"warn" });
      loadAlerts();
    }
  }catch(e){
    addAlert({ title:"Offline SOS via SMS", ts:"Now", body:"SMS sent to Police + Guardians with your last known location.", type:"warn" });
    toast("Offline: SMS SOS sent");
    loadAlerts();
  }
});

/* -------------------- Map -------------------- */
$("[data-back='dashboard']").addEventListener("click", ()=> go("dashboard"));
$("#simulateFence").addEventListener("click", ()=>{
  const b=$("#geofenceBanner"); show(b);
  setTimeout(()=> hide(b), 4000);
  addAlert({ title:"Geo-fence Alert", ts:"Now", body:"High-Risk Zone entered. Stay alert.", type:"warn" });
});
$("#openIncident").addEventListener("click", async ()=>{
  await loadAreaInfo();
  go("incident");
});

/* -------------------- Incident & Area Info -------------------- */
async function loadAreaInfo(){
  try{
    const res = await api.call("/api/area?lat=0&lng=0",{ method:"GET" });
    if(!res.ok) throw new Error();
    const data = await res.json();
    $("#safetyScore").textContent = data.score.toFixed(1) + "/5";
    $("#safetyIcon").textContent = data.score >=4 ? "ğŸŸ¢" : data.score >=3 ? "ğŸŸ¡" : "ğŸ”´";
    const list=$("#incidentList"); list.innerHTML="";
    data.incidents.forEach(it=>{
      const row = document.createElement("div");
      row.className="p-3 rounded-xl border border-slate-200 flex items-center justify-between";
      row.innerHTML = `<div class="text-xs"><span class="font-semibold">${it.type}</span> â€¢ ${it.date}</div>
      <span class="text-xs ${it.level==='High'?'bg-red-50 text-red-700':'bg-yellow-50 text-yellow-700'} px-2 py-0.5 rounded">${it.level}</span>`;
      list.appendChild(row);
    });
    const tips=$("#touristTips"); tips.innerHTML="";
    data.tips.forEach(t=>{ const li=document.createElement("li"); li.textContent=t; tips.appendChild(li); });
  }catch(e){
    $("#safetyScore").textContent = "3.8/5";
  }
}
$("#toProfileFromIncident").addEventListener("click", ()=> go("profile"));

/* -------------------- Feed -------------------- */
async function loadFeed(){
  const list = $("#feedList"); list.innerHTML="";
  try{
    const res = await api.call("/api/feed",{ method:"GET" });
    const data = await res.json();
    data.items.forEach(item=>{
      const card = document.createElement("div");
      card.className="p-4 rounded-2xl border border-slate-200";
      card.innerHTML = `<div class="flex items-center justify-between">
        <div class="font-semibold text-sm text-slate-800">${item.title}</div>
        <div class="text-[11px] text-slate-500">${item.date}</div>
      </div>
      <p class="mt-1 text-xs text-slate-600">${item.body}</p>`;
      list.appendChild(card);
    });
  }catch(e){
    const empty = document.createElement("div");
    empty.className="text-xs text-slate-500";
    empty.textContent="Offline: showing last saved feed.";
    list.appendChild(empty);
    mockDB.feed.forEach(item=>{
      const card=document.createElement("div");
      card.className="p-4 rounded-2xl border border-slate-200";
      card.innerHTML=`<div class="flex items-center justify-between">
        <div class="font-semibold text-sm text-slate-800">${item.title}</div>
        <div class="text-[11px] text-slate-500">${item.date}</div></div>
        <p class="mt-1 text-xs text-slate-600">${item.body}</p>`;
      list.appendChild(card);
    });
  }
}

/* -------------------- Alerts -------------------- */
const alertsStore = [];
const complaintsStore = [];
function addAlert(a){ alertsStore.unshift({ ...a, id: Date.now() }); }
function loadAlerts(){
  const wrap = $("#alertsList"); wrap.innerHTML="";
  if (alertsStore.length===0){
    addAlert({ title:"Check-in Reminder", ts:"Yesterday", body:"Daily check-in at 8pm.", type:"note" });
  }
  alertsStore.forEach(a=>{
    const card = document.createElement("div");
    card.className="p-4 rounded-2xl border border-slate-200";
    card.innerHTML = `<div class="flex items-center justify-between">
      <div class="text-sm font-semibold text-slate-800">${a.title}</div>
      <div class="text-[11px] text-slate-500">${a.ts}</div>
    </div>
    <p class="text-xs text-slate-600 mt-1">${a.body}</p>`;
    wrap.appendChild(card);
  });
}
function loadMyComplaints(){
  const wrap = document.getElementById("complaintsList");
  wrap.innerHTML = complaintsStore.length? "" : '<div class="text-xs text-slate-500">No complaints yet.</div>';
  complaintsStore.forEach(c=>{
    const card = document.createElement("div");
    card.className = "p-4 rounded-2xl border border-slate-200 bg-white";
    card.innerHTML = `
      <div class="flex items-center justify-between">
        <div class="text-sm font-semibold text-slate-800">${c.category} â€¢ <span class="text-slate-500 text-xs">${c.ref}</span></div>
        <span class="text-[11px] px-2 py-0.5 rounded ${c.status==='Submitted'?'bg-yellow-50 text-yellow-700':'bg-green-50 text-green-700'}">${c.status}</span>
      </div>
      <p class="text-xs text-slate-600 mt-1">${escapeHtml(c.desc||'')}</p>
      <div class="mt-3 grid grid-cols-2 gap-2 text-xs">
        <div class="p-2 rounded-lg bg-slate-50 border border-slate-100"><div class="text-slate-500">Officer</div><div class="font-semibold">${c.officer.name}</div></div>
        <div class="p-2 rounded-lg bg-slate-50 border border-slate-100"><div class="text-slate-500">Department</div><div class="font-semibold">${c.officer.department}</div></div>
        <div class="p-2 rounded-lg bg-slate-50 border border-slate-100"><div class="text-slate-500">Phone</div><div class="font-semibold">${c.officer.phone}</div></div>
        <div class="p-2 rounded-lg bg-slate-50 border border-slate-100"><div class="text-slate-500">Precinct</div><div class="font-semibold">${c.details.precinct}</div></div>
      </div>
      <div class="mt-2 text-[11px] text-slate-500">SLA: ${c.details.sla} â€¢ ${new Date(c.createdAt).toLocaleString()}</div>
      <div class="mt-1 text-[11px] text-slate-500">Notes: ${c.details.notes}</div>
      <div class="mt-3 flex gap-2">
        <button class="px-3 py-1.5 rounded-lg bg-blue-50 text-blue-700 text-xs font-semibold">Call Officer</button>
        <button class="px-3 py-1.5 rounded-lg bg-green-50 text-green-700 text-xs font-semibold">Mark Resolved</button>
      </div>
    `;
    wrap.appendChild(card);
  });
}

/* -------------------- Profile Toggles -------------------- */
const toggleCheckin=$("#toggleCheckin"), checkinKnob=$("#checkinKnob"), checkinHint=$("#checkinHint");
toggleCheckin.addEventListener("change", ()=>{
  if (toggleCheckin.checked){
    checkinKnob.style.left='1.375rem';
    checkinKnob.parentElement.style.background='rgba(16,185,129,.9)';
    show(checkinHint);
    addAlert({ title:"Check-in Enabled", ts:"Now", body:"Daily reminder set for 8pm.", type:"note" });
  } else {
    checkinKnob.style.left='.125rem';
    checkinKnob.parentElement.style.background='';
    hide(checkinHint);
    addAlert({ title:"Check-in Disabled", ts:"Now", body:"Reminders turned off.", type:"note" });
  }
});

/* -------------------- Chat -------------------- */
async function loadMessages(){
  try{
    const res = await api.call("/api/messages",{ method:"GET" });
    const data = await res.json();
    return data.items;
  }catch(e){
    return mockDB.messages;
  }
}
function renderChat(){
  const wrap = $("#chatThread");
  wrap.innerHTML="";
  loadMessages().then(items=>{
    items.sort((a,b)=> a.ts-b.ts).forEach(m=>{
      const row = document.createElement("div");
      const mine = m.from==="you";
      row.className = "flex " + (mine ? "justify-end" : "justify-start");
      row.innerHTML = `<div class="max-w-[75%] px-3 py-2 rounded-2xl ${mine?'bg-blue-600 text-white':'bg-white border border-slate-200'}">
        <div class="text-xs">${escapeHtml(m.text)}</div>
        <div class="text-[10px] mt-1 opacity-80">${formatTime(m.ts)} ${mine? (m.read?'âœ“âœ“':'âœ“'):''}</div>
      </div>`;
      wrap.appendChild(row);
    });
    wrap.scrollTop = wrap.scrollHeight;
  });
}
$("#chatForm").addEventListener("submit", async (e)=>{
  e.preventDefault();
  const input = $("#chatInput");
  const text = input.value.trim();
  if (!text) return;
  input.value="";
  try{
    await api.call("/api/messages",{ method:"POST", body: JSON.stringify({ text }) });
  }catch(e){
    mockDB.messages.push({ id: Date.now(), from:"you", text, ts: Date.now(), read:false });
  }
  renderChat();
});

/* -------------------- Calls -------------------- */
$("#openAudio").addEventListener("click", ()=>{
  go("call");
  $("#callTitle").textContent="Audio Call";
  hide($("#videoPreview"));
  hide($("#btnCam"));
  startCall({ video:false });
});
$("#openVideo").addEventListener("click", ()=>{
  go("call");
  $("#callTitle").textContent="Video Call";
  show($("#videoPreview"));
  show($("#btnCam"));
  startCall({ video:true });
});
let callActive=false, muted=false, camOn=true;
async function startCall(opts){
  callActive=true; muted=false; camOn=true;
  try{
    await api.call("/api/call",{ method:"POST", body: JSON.stringify({ type: opts.video?'video':'audio' }) });
  }catch(e){ /* offline UI only */ }
}
$("#btnMute").addEventListener("click", ()=>{
  muted = !muted;
  $("#btnMute").textContent = muted? "Unmute":"Mute";
  toast(muted? "Muted":"Unmuted");
});
$("#btnCam").addEventListener("click", ()=>{
  camOn = !camOn;
  $("#btnCam").textContent = camOn? "Camera Off":"Camera On";
  $("#videoPreview").textContent = camOn? "Video Preview":"Camera Off";
});
$("#btnEnd").addEventListener("click", ()=>{
  callActive=false;
  go("dashboard");
  toast("Call ended");
});

/* -------------------- AI Safety Bot -------------------- */
$("#botFab").addEventListener("click", ()=> show($("#botPanel")));
$("#botClose").addEventListener("click", ()=> hide($("#botPanel")));
$("#botForm").addEventListener("submit", async (e)=>{
  e.preventDefault();
  const input = $("#botInput");
  const text = input.value.trim();
  if (!text) return;
  const lang = $("#botLang").value;
  botAdd("you", text);
  input.value="";
  try{
    const res = await api.call("/api/ai-bot",{ method:"POST", body: JSON.stringify({ text, lang }) });
    const data = await res.json();
    botAdd("bot", data.reply);
  }catch(e){
    botAdd("bot", "(Offline) Here are basic tips: Keep belongings safe, use main roads, call local emergency numbers 100/112.");
  }
});
function botAdd(who, text){
  const wrap = $("#botMessages");
  const row = document.createElement("div");
  row.className = "flex "+(who==="you"?"justify-end":"justify-start");
  row.innerHTML = `<div class="max-w-[80%] px-3 py-2 rounded-2xl ${who==='you'?'bg-blue-600 text-white':'bg-white border border-slate-200'} text-xs">${escapeHtml(text)}</div>`;
  wrap.appendChild(row);
  wrap.scrollTop = wrap.scrollHeight;
}
function botLogic(text, lang){
  const t = text.toLowerCase();
  const tr = {
    EN:{
      lost:"Share your live location with guardians. Head to nearest police help desk or safe zone highlighted green.",
      hospital:"Nearest hospital pinned on map. If severe, dial Ambulance 102/108.",
      numbers:"Police 100 / 112, Ambulance 102/108, Fire 101.",
      tips:"Stay on lit roads, keep phone charged, save emergency contacts.",
      translate:"Emergency! I need help. = à¤®à¤¦à¤¦ à¤•à¥€à¤œà¤¿à¤! à¤®à¥à¤à¥‡ à¤®à¤¦à¤¦ à¤šà¤¾à¤¹à¤¿à¤à¥¤"
    },
    HI:{
      lost:"à¤…à¤ªà¤¨à¤¾ à¤²à¤¾à¤‡à¤µ à¤²à¥‹à¤•à¥‡à¤¶à¤¨ à¤…à¤­à¤¿à¤­à¤¾à¤µà¤•à¥‹à¤‚ à¤¸à¥‡ à¤¸à¤¾à¤à¤¾ à¤•à¤°à¥‡à¤‚à¥¤ à¤¨à¤¿à¤•à¤Ÿà¤¤à¤® à¤ªà¥à¤²à¤¿à¤¸ à¤¸à¤¹à¤¾à¤¯à¤¤à¤¾ à¤¡à¥‡à¤¸à¥à¤• à¤¯à¤¾ à¤¹à¤°à¥‡ à¤¸à¥à¤°à¤•à¥à¤·à¤¿à¤¤ à¤•à¥à¤·à¥‡à¤¤à¥à¤° à¤•à¥€ à¤“à¤° à¤œà¤¾à¤à¤à¥¤",
      hospital:"à¤¨à¤¿à¤•à¤Ÿà¤¤à¤® à¤…à¤¸à¥à¤ªà¤¤à¤¾à¤² à¤®à¤¾à¤¨à¤šà¤¿à¤¤à¥à¤° à¤ªà¤° à¤šà¤¿à¤¨à¥à¤¹à¤¿à¤¤ à¤¹à¥ˆà¥¤ à¤—à¤‚à¤­à¥€à¤° à¤¸à¥à¤¥à¤¿à¤¤à¤¿ à¤®à¥‡à¤‚ 102/108 à¤ªà¤° à¤•à¥‰à¤² à¤•à¤°à¥‡à¤‚à¥¤",
      numbers:"à¤ªà¥à¤²à¤¿à¤¸ 100 / 112, à¤à¤®à¥à¤¬à¥à¤²à¥‡à¤‚à¤¸ 102/108, à¤«à¤¾à¤¯à¤° 101.",
      tips:"à¤°à¥‹à¤¶à¤¨à¥€ à¤µà¤¾à¤²à¥‡ à¤®à¤¾à¤°à¥à¤—à¥‹à¤‚ à¤ªà¤° à¤°à¤¹à¥‡à¤‚, à¤«à¥‹à¤¨ à¤šà¤¾à¤°à¥à¤œ à¤°à¤–à¥‡à¤‚, à¤†à¤ªà¤¾à¤¤ à¤¸à¤‚à¤ªà¤°à¥à¤• à¤¸à¥à¤°à¤•à¥à¤·à¤¿à¤¤ à¤°à¤–à¥‡à¤‚.",
      translate:"Emergency! I need help. = à¤®à¤¦à¤¦ à¤•à¥€à¤œà¤¿à¤! à¤®à¥à¤à¥‡ à¤®à¤¦à¤¦ à¤šà¤¾à¤¹à¤¿à¤à¥¤"
    }
  }[lang||"EN"];
  if (t.includes("lost")) return tr.lost;
  if (t.includes("hospital")) return tr.hospital;
  if (t.includes("number")) return tr.numbers;
  if (t.includes("tip")) return tr.tips;
  if (t.includes("translate") || t.includes("phrase")) return tr.translate;
  return lang==="HI" ? "à¤®à¥ˆà¤‚ à¤†à¤ªà¤•à¥€ à¤¸à¤¹à¤¾à¤¯à¤¤à¤¾ à¤•à¥‡ à¤²à¤¿à¤ à¤¯à¤¹à¤¾à¤ à¤¹à¥‚à¤à¥¤ à¤…à¤§à¤¿à¤• à¤œà¤¾à¤¨à¤•à¤¾à¤°à¥€ à¤¦à¥‡à¤‚à¥¤" : "I'm here to help. Tell me more.";
}

/* -------------------- PLUS FAB: Quick Menu (always available) -------------------- */
const plusFab = $("#plusFab");
const plusMenu = $("#plusMenu");
plusFab.addEventListener("click", (e)=>{
  e.stopPropagation();
  if (plusMenu.classList.contains("hidden")) {
    show(plusMenu);
    plusMenu.classList.add("menu-pop");
    setTimeout(()=> plusMenu.classList.remove("menu-pop"), 260);
  } else {
    hide(plusMenu);
  }
});
document.addEventListener("click", (e)=>{
  if (plusMenu && !plusMenu.contains(e.target) && e.target!==plusFab) hide(plusMenu);
});
$("#menuRegister").addEventListener("click", ()=>{
  hide(plusMenu);
  go("complaint");
});
$("#menuMyComplaints").addEventListener("click", ()=>{
  hide(plusMenu);
  loadMyComplaints();
  go("mycomplaints");
});

/* -------------------- Complaint Form -------------------- */
const complaintShareLoc = $("#complaintShareLoc");
const complaintLocKnob = $("#complaintLocKnob");
complaintShareLoc.addEventListener("change", ()=>{
  if (complaintShareLoc.checked){
    complaintLocKnob.style.left='1.375rem';
    complaintLocKnob.parentElement.style.background='rgba(59,130,246,.9)';
  }else{
    complaintLocKnob.style.left='.125rem';
    complaintLocKnob.parentElement.style.background='';
  }
});
$("#complaintAttach").addEventListener("click", ()=> toast("Photo attached (demo)"));
$("#complaintForm").addEventListener("submit", async (e)=>{
  e.preventDefault();
  const payload = {
    category: $("#complaintCat").value,
    desc: $("#complaintDesc").value.trim(),
    shareLoc: complaintShareLoc.checked,
    location: { lat: 18.5204, lng: 73.8567 }
  };
  try{
    const res = await api.call("/api/complaint",{ method:"POST", body: JSON.stringify(payload) });
    const data = await res.json();
    addAlert({ title:"Complaint Registered", ts:"Now", body:`Ref: ${data.ref}. ${payload.category}.`, type:"note" });
    toast("Complaint submitted");
    loadAlerts();
    loadMyComplaints();
    go("mycomplaints");
  }catch(e){
    const ref = "CMP-" + Math.floor(Math.random()*9999);
    complaintsStore.unshift({
      id: Date.now(), ref,
      category: payload.category, desc: payload.desc,
      createdAt: new Date().toISOString(), status: "Submitted",
      officer: { name: "Pending", department: "Pending", phone: "-" },
      details: { precinct: "-", sla: "24h", notes: "Will sync when online" }
    });
    addAlert({ title:"Complaint Saved Offline", ts:"Now", body:`Will sync when online. ${payload.category}.`, type:"note" });
    toast("Offline: complaint saved");
    loadAlerts();
    loadMyComplaints();
    go("mycomplaints");
  }
});

/* -------------------- Utilities -------------------- */
function escapeHtml(s){ return s.replace(/[&<>"']/g, m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[m])) }
function formatTime(ts){ const d=new Date(ts); return d.getHours().toString().padStart(2,"0")+":"+d.getMinutes().toString().padStart(2,"0"); }

/* -------------------- Back buttons -------------------- */
$$("[data-back='dashboard']").forEach(b=> b.addEventListener("click", ()=> go("dashboard")));
$$("[data-back='map']").forEach(b=> b.addEventListener("click", ()=> go("map")));

/* -------------------- Accessibility: larger hit-areas -------------------- */
$$("button").forEach(b=>{ if(!b.className.includes("py-")) b.classList.add("py-2"); });
</script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9806969563ab7ec4',t:'MTc1ODA5MDk3NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
